app-id: org.datcord.Datcord
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: datcord
modules:
  - shared-modules/gtk2/gtk2.json
  - shared-modules/python2.7/python-2.7.json
  - shared-modules/dbus-glib/dbus-glib.json
  - name: put
    buildsystem: simple
    build-commands:
      - echo `pwd`
      - ls
      - install -d "/app/lib"
      - install -d "/app/lib/datcord"
      - install -d "/app/bin"
      - tar --strip-components=1 -xvf  *.tar.bz2 -C "/app/lib/datcord"

      - install -D -m644 -t "/app/usr/share/icons/" datcord256.png

      - install -d "/app/lib/ffmpeg"
      - install -d "/app/etc/datcord"

      - install -D -m644 -t "/app/lib/datcord/distribution" policies.json

      - install -D -m755 "open-in-default-browser" "/app/lib/datcord/"
      - install -D -m755 "launch-datcord" "/app/lib/datcord/"

      - ln -s "/app/lib/datcord/launch-datcord" "/app/bin/datcord"

    sources:
      - type: dir
        path: ../../mozilla-unified/obj-x86_64-pc-linux-gnu/dist/
      
      - type: file
        path: datcord256.png
      
      - type: file
        path: policies.json

      - type: file
        path: ../../open-in-default-browser/open-in-default-browser

      - type: file
        path: ../../src/launch-datcord


finish-args:
    - --allow=devel                                           
    - --share=ipc                                             
    - --share=network                                         
    - --env=GTK_PATH=/app/lib/gtkmodules                      
    - --socket=pulseaudio                                     
    - --socket=wayland                                        
    - --socket=fallback-x11                                            
    - --socket=pcsc                                           
    - --socket=cups                                           
    - --require-version=0.11.1                                
    - --persist=.datcord                                      
    - --filesystem=xdg-download:rw                            
    - --filesystem=/run/.heim_org.h5l.kcm-socket              
    - --filesystem=/tmp                                       
    - --device=all                                            
    - --talk-name=org.freedesktop.FileManager1                
    - --system-talk-name=org.freedesktop.NetworkManager       
    - --talk-name=org.a11y.Bus                                
    - --talk-name=org.gnome.SessionManager                    
    - --talk-name=org.freedesktop.ScreenSaver                 
    - --talk-name=org.freedesktop.Notifications               
#    - --own-name="org.datcord.Datcord"                        
    - --command=datcord
    - --filesystem=home:rw
    - --env=GTK_THEME_VARIANT=dark
    - --device=dri
    - --filesystem=~/.config/dconf:ro
    - --env=DCONF_USER_CONFIG_DIR=.config/dconf
    - --socket=session-bus
